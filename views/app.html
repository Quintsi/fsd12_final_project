<include href="includes/head.html">

        <div class="{{ @container }} container-fluid d-flex flex-column h-100 p-0">

            <!-- Navigation -->
            <include href="includes/header.html">

            <!-- Main todo container -->
            <div id="list-container" class="m-auto col-11 col-lg-9 col-xl-8 py-2">
                <div class="row h-100">

                    <!-- Lists -->
                    <aside class="offset-xl-2 col-md-5 col-lg-4 col-xl-3 px-4">
                        <!--  list creation input field  -->
                        <form action="{{ @BASE }}{{ 'createList' | alias }}" method="POST" class="my-4 mt-md-5">
                            <fieldset class="d-flex flex-column mx-auto text-center">
                                <legend class="ms-2">Create list</legend>
                                <div class="input-wrapper d-flex align-items-center justify-content-end p-2">
                                    <input type="text" id="list-name" name="title">
                                    <input type="submit" class="btn-add fa" value="&#x2b">
                                </div>
                            </fieldset>
                        </form>

                        <!--  list items   -->
                        <ul class="list-item">
                            <repeat group="{{ @lists }}" value="{{ @list }}">
                                <check if="{{ isset(@selectedId) && @list['id'] == @selectedId }}">
                                    <true><set chkSelected="checked"></true>
                                    <false><set chkSelected=""></false>
                                </check>
                                <li class="d-flex w-100 mx-auto">
                                    <input 
                                        {{ @chkSelected }} 
                                        id="list{{ @list['id'] }}" 
                                        type="radio" name="lists" 
                                        value="{{ @list['id'] }}" 
                                        data-url="{{ @BASE }}{{ 'appList', ['id'=>@list['id']] | alias }}">
                                    <div class="d-flex align-items-center w-100">
                                        <label class="w-75 p-2" for="list{{ @list['id'] }}">{{ @list["title"] }}</a></label>
                                        <div class="menu w-25 text-end me-2">
                                            <img src="images/icon/move.png" alt="move icon" class="icon">
                                            <img src="images/icon/trash-can.png" alt="trash icon" class="icon">
                                        </div>
                                    </div>
                                </li>
                            </repeat>
                        </ul>
                    </aside>
                    
                    <!--  main content of the to-do manager -- all tasks are listed here  -->
                    <main class="content col-md-7 col-lg-8 col-xl-5 py-4">
                        
                        <div class="px-3">
                            <!--  title of the currently selected list  -->
                            <form id="list-title-form" action="{{ @BASE }}{{ 'editListTitle' | alias }}" method="POST">
                                <input type="text" name="title" value="{{ @selectedTitle ?? 'TODO' }}" class="w-100">
                            </form>

                            <!--  tabs to control which tasks are displayed (all, active, completed, priority) -->
                            <div class="tab-wrapper w-100 d-flex mb-4">
                                <div id="modes" class="d-flex justify-content-between w-50 me-5">
                                    <a href="{{ @BASE }}{{ 'appListMode', ['mode' => 'all'] | alias }}" class="{{ @mode == 'all' ? 'active' : ''}} p-3">All</a>
                                    <a href="{{ @BASE }}{{ 'appListMode', ['mode' => 'active'] | alias }}" class="{{ @mode == 'active' ? 'active' : ''}} p-3">Active</a>
                                    <a href="{{ @BASE }}{{ 'appListMode', ['mode' => 'completed'] | alias }}" class="{{ @mode == 'completed' ? 'active' : ''}} p-3">Completed</a>
                                    <!--<label>
                                        <input type="checkbox" class="{{ @mode == 'all' ? 'active' : ''}}"> All
                                    </label>
                                    <label>
                                        <input type="checkbox"> Active
                                    </label>
                                    <label>
                                        <input type="checkbox"> Completed
                                    </label>-->
                                </div>
                            

                                <!--  priority tab which uses a slider graphic  -->
                                <div id="priority" class="d-flex justify-content-center align-items-center">
                                    <p class="me-2 mb-0">By Priority</p>
                                    <div class="slider d-flex align-items-center" id="slider">
                                        <div class="bar"></div>
                                        <div class="circle"></div>
                                    </div>
                                </div>
                            </div>



                            <!--  task items  -->
                            <div id="tasks-container">
                                <ul>
                                    <repeat group="{{ @tasks }}" value="{{ @task }}">
                                        <check if="{{ @task['is_completed'] == 1}}">
                                            <true><set taskCompleted="active"></set></true>
                                            <false><set taskCompleted=""></set></false>
                                        </check>
                                        <li id="t-{{ @task['id']}}" class="d-flex w-100 mb-4">
                                            <div>
                                                <div class="marker priority priority-{{ @task['priority'] }} {{ @taskCompleted == 'active' ? 'hide' : ''}}"><i class="fa-solid fa-circle"></i></div>
                                                <div class="marker checkmark {{ @taskCompleted }}"><i class="fa-solid fa-circle-check"></i></div>
                                            </div>
                                            <div class="d-flex flex-column w-100">
                                                <p data-url="{{ @BASE }}{{ 'toggleTask', ['id' => @task['id']] | alias }}" class="mb-2 task-content {{ @taskCompleted }}">{{ @task["content"] | nl2br }}</p>
                                                <div class="d-flex">
                                                    <div class="{{ @task['due_date'] == '' || @taskCompleted ? 'd-none' : 'd-flex' }} task-date justify-content-center align-items-center rounded-5">{{ @task["due_date"] }}</div>
                                                </div>
                                            </div>
                                            <div class="text-center">
                                                <!-- TODO: Edit button should open the task-add-container with prefilled information? -->
                                                <a class="task-icon task-edit" href="#"><i class="fa-solid fa-pen-to-square"></i></a>
                                                <a class="task-icon task-delete" href="{{ @BASE }}{{ 'deleteTask', ['id' => @task['id'] ] | alias }}"><i class="fa-solid fa-trash-can"></i></a>
                                            </div>
                                        </li>
                                    </repeat>
                                </ul>
                            </div>
                        </div>

                        <div id="task-add-container" class="w-100">
                            <form action="{{ @BASE }}{{ 'createTask' | alias }}" method="POST" id="task-add-form" class="col-11 col-md-8 align-items-center mx-auto pt-3 px-3 rounded-2">
                                <div class="d-flex mb-2">
                                    <div id="task-add-priority" class="input-group input-group-sm">
                                        <label class="input-group-text" id="add-priority">Priority</label>
                                        <select class="form-control" id="add-priority" name="priority">
                                            <option value="0">None</option>
                                            <option value="1">Low</option>
                                            <option value="2">High</option>
                                        </select>
                                    </div>
                                    <div id="task-add-due-date" class="input-group input-group-sm">
                                        <label class="input-group-text" for="add-due-date">Due date</label>
                                        <input type="date" class="form-control" id="add-due-date" name="due_date">
                                    </div>
                                </div>
                                <!-- Create task -->
                                <div id="task-add-content" class="input-group input-group-sm h-75 mb-3">
                                    <label class="input-group-text" for="add-content">Task</label>
                                    <textarea class="form-control" id="add-content" name="content" required></textarea>
                                </div>
                                <div class="d-flex justify-content-center align-items-center">
                                    <input type="submit" class="btn-add me-3 fa" value="&#x2b">
                                    <input type="reset" class="btn-add fa" value="&#xf12d">
                                </div>
                            </form>

                            <button id="task-add-btn" type="button" class="btn-add text-center">
                                <i class="close fa-solid fa-xmark"></i>
                                <i class="open fa-solid fa-plus"></i>
                            </button>
                        </div>
                        
                    </main>

                </div>
            </div>
            <include href="includes/footer.html">
        </div>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
        <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
        <script src="js/app.js"></script>
        <script>
            // Run once when the page is loaded to pass certain behaviors.
            /*let modeAdd = "{{ isset(@modeAdd) }}";
            $(function() {
                if (modeAdd == "true") $("#task-add-btn").click();
            })*/
        </script>
    </body>
</html>